---
layout: caymanyomi
category: misc
docid: epub
title: マルチメディアデイジー EPUB3 サンプル
author: 水野光子
date: 2020-09-15T03:27:33Z
iro: 1986fa
gra: ffe8fa
---

# マルチメディアデイジー EPUB3 サンプル
{:.no_toc}

## 目次
{:.no_toc}

* TOC
{:toc}

## このサンプルについて

国会図書館に納本できる形式 EPUB 3 で作成したマルチメディアデイジーのサンプルです。著作権上の問題を避けるため、[青空文庫の書籍](https://www.aozora.gr.jp/cards/000042/card2507.html)を使っています。

- [電子書籍の国際規格 EPUB 3.2](https://www.w3.org/publishing/epub3/epub-overview.html) に従い、[ウェブコンテンツのアクセシビリティの国際的ガイドライン WCAG 2.2](https://www.w3.org/TR/WCAG22/) のレベル AA （ダブル エー）に相当しています。
  - [EPUBCheck](https://github.com/w3c/epubcheck) を使って、 EPUB 3.2 に適合していることを確認しています。
  - [Ace by DAISY](https://daisy.github.io/ace/getting-started/ace-app/) を使って、アクセシビリティに関する構造に問題ないことを確認しています。
  - [WCAG 2.1 クイックリファレンス](https://www.w3.org/WAI/WCAG21/quickref/)によれば、「著作権ガイド」「終わりアナウンス」など全てのセクションのタイトルを表示して読み上げる、すべての漢字にルビを付ける、などの処置をするとレベル AAA （トリプル エー）に成れそうです。ただし、ガイドラインはランク付けの基準を出しているだけで、 AAA でなければアクセシブルでないというわけではないです。


## 使い方

1. [サンプル書籍 sample20200911.epub](media/epub/sample20200911.epub) をパソコンにダウンロードします。
1. [Thorium Reader](https://www.edrlab.org/software/thorium-reader/) をインストールします。
  - [Windows 10 では Windows ストアからインストールできます。](https://www.microsoft.com/ja-jp/p/thorium-reader/9nfzp1g7m2sc?activetab=pivot:overviewtab)
  - それ以外のOSをご利用の方は、[上記の Thorium Reader のページ](https://www.edrlab.org/software/thorium-reader/) から適切なものを選んでダウンロードしてインストールしてください。
1. Thorium Reader を起動します。
1. Thorium Reader の画面上部の + マークを押すか、 sample20200911.epub を Thorium Reader のウィンドウ内にドラッグすることによって、この書籍を「わたしの本」のリストに追加できます。  
  ![Thorium画面1](media/epub/thorium1.png){: .naka}
1. リストに入った本の表紙をクリックすると、本が開きます。  
  ![Thorium画面2](media/epub/thorium2.png){: .naka}
1. 開いた画面上部のスピーカーのようなマークを押すと、読み上げのための操作盤が表示され、読み上げが始まります。
1. サンプル書籍では、音訳者が追加した部分が〔全角亀甲括弧〕付きで表示されています。それらのうち本文中の追加部分は、読み飛ばし機能をオンにすると読み上げないようになります。  
  Thorium画面上部右の方にある aa マークをクリックし、「本文の読み上げ」「読み飛ばし機能」のチェックボックスをクリックして、オン・オフを切り替えます。  
  ![Thorium画面3](media/epub/thorium3.png){: .naka}


## ソフトウェアの利用

ChattyInfty3 と Tobi を使ってサンプルを作成した。
: ただし、どちらからエクスポートしても、 Ace by DAISY でアクセシブルな構造に関する問題点が確認される。今回はその出力ファイルを手で直した。
: ChattyInfty3 機能の図説明は、画像が表示され、その説明が読み上げられるが、説明に対応する文字はEPUB書籍内に存在しない。この形式の場合、点字ディスプレイなどから音訳者説明を利用することができないので、アクセシビリティの観点から問題がある。この機能は使わないことにする。
: Tobi 機能の図説明は、デフォルトで隠されているが、ワンタッチで文の表示を展開できるようになっている。
: これらのアプリケーションではスキップ機能を設定できないので、手作業で入れた。
: 今後、マルチメディアデイジーの作成を続けるために、自動修正の方法、それに合わせて効率的にグループ作業するための方法を考え中。

PLEXTALK Producer で同じサンプルを作ろうとしたが、
: やはり Ace by DAISY では問題点が確認される。
: PLEXTALK Producer で音訳者説明をスキップできるフレーズとして設定しても、 EPUB with Media Overlays の規格上でスキップできると指定されている形にならず（というよりむしろ規格上避けたいものと指定されている形になっている）、 Thorium Reader のスキップ機能が働かない。2020年7月31日の PLEXTALK Producer アップデートをしてもこの問題が出るので、アプリケーション製作者の EPUB 規格解釈が間違っているのか、何らかの理由でわざと無視していると思われる。
: PLEXTALK Producer での音声ファイルの割り当て作業が、 Tobi に比べると格段に煩わしい。音声ファイル割り当てに利用するアプリケーションは Tobi に統一したほうが良さそう。

## 技術的メモ

### テキスト構造化のために ChattyInfty3 を使う

数々のXMLエディタやワープロソフト、 PLEXTALK Producer などでも、テキストをepub用に構造化することはできる。その中で ChattyInfty3 を選ぶ最大の理由は、読み上げと連動してハイライトされるフレーズ区切りの指定が簡単にできることである。

その代わり、 ChattyInfty3 の最大の難点である、日本語に無い文字の処理について、特別な対処をしなければいけない。

 ChattyInfty3 内部の処理は UTF-8 ではなく Shift_JIS で行われているため、日本語にない文字の合成音声による読み上げができない。また、書誌情報に日本語にない文字があると文字化けする。

対処方法として、以下の2点を採用する。

- 正しい外国語の読み上げを音声ファイルで当てる。
- 書誌情報は、納品前のアクセシブル化処理のついでに、正しい文字に直す。


### 国立国会図書館納品の基準

- [納本を受け入れる基準](https://www.ndl.go.jp/jp/library/supportvisual/supportvisual-10_01.html#a511)は厳しくない。マルチメディアデイジー特有の仕様は次のとおり。  
```
E	データ形式について…お願い
同じ資料（タイトル）で異なる形式のものがある場合は、次の形式を優先としてください。

■DAISY
バージョン： 2.02
音声圧縮形式： MP3
※1個のMP3ファイルのサイズが100MBを超えるとエラーになることがあります。
文字コードセット： Shift_JIS
※コードが異なるとAMISなど一部のソフトで文字化けすることがあります。

■EPUB（メディアオーバーレイ）
バージョン： 3.0以上
音声圧縮形式： MP3
文字コードセット： UTF-8
```
- [国立国会図書館が作成しているデータ仕様](https://www.ndl.go.jp/jp/library/supportvisual/supportvisual-02.html)がある。  
    やまびこのような外部団体から納本するものがこれに従う必要はないが、参考にする。

### 国立国会図書館が作成しているデータの仕様を参考にした、音声付き EPUB のための仕様案


#### 1. EPUBに関する仕様

[学術文献の視覚障害者等用EPUB製作仕様書（ver.2020.1）（PDF: 1.5MB）](https://www.ndl.go.jp/jp/library/supportvisual/docs/ac_epub_spec.pdf)を参考にする。

ただしこの仕様書はテキストデータのEPUB化の指針であり、smil等の扱いについては書かれていない。音声付きEPUB作成のためには、独自の「やまびこ仕様」を追加する必要がある。

以下では、国立国会図書館の仕様書から参考にした部分と、それに対するやまびこでの適用方法を列挙する。

```
「1 総則」
（１）学術文献の用途に鑑み、論文執筆等における引用に対応できるようにするため、原則として、原本の表記に忠実に従う。
（２）明らかに誤植、誤記、脱字と判断できるものも訂正せずに原本に忠実に入力する。ただし、原本に正誤表がある場合は、正誤表のとおり訂正する。
```
やまびこ仕様
: 文字は絶対に原本通りに書く。これは引用に対応するためである。音訳では文意が正しく伝わることを優先するので、直して読み上げても良い。誤植の文字は直さないが、読み上げでは直していることについて、デイジー図書凡例で言う。

```
「1 総則」
（３）EPUB Accessibility 1.0のうちの以下の要件を満たすものとする。製作の詳細は本仕様を参照する。
①「発見可能なEPUB出版物（2.1  Discoverable EPUB Publications）」の要件（推奨要件を含む）を満たしていること。
②「アクセシブルなEPUB出版物(2.2 Accessible EPUB Publications)」の要件（推奨要件を含む）を満たしていること。これには、Web  Content  Accessibility  Guidelines（WCAG）2.0レベルAAの要件を準拠することが含まれている。
```
やまびこ仕様
: WCAG レベル AA か AAA になるように作成する。

```
「2 最終成果物のEPUBの形式」
EPUBの形式は、EPUB3.2のリフロー型とする。最新版のepubcheckでエラーが出ないものを製作すること。

「3 文字コード及び改行コード」
改行コード「CR+LF」、「CR」、「LF」のいずれかを使用することとし、同一タイトル内で混在させない。

「4 EPUB製作者が追記する注記・凡例」
本件作業に関して利用者に伝えるべき補足情報がある場合は、全体に係るものは「4.1 テキストデータ凡例」、個々の箇所に係るものは「4.2 製作者注記」のとおり入力する。
「補足資料1」
 *1原本に見出し語句がない箇所には、「序」「はしがき」「目次」「索引」「著者略歴」等、原本の内容にあった見出しを入力する。
「9.2 見出しレベルの設定・見出しの階層付け」
見出し部分のテキストは、原本の内容に基づき、編・章・節・項等の見出しの階層に合わせて見出しレベルの設定・見出しの階層付けをh1要素からh6要素を用いて行う（詳細は「補足資料2 見出しの設定・階層付けの方針」を参照）。次の事項をテキストデータ化したセクションの階層は「レベル１」とする。
○冒頭に記載するEPUBのタイトル
○製作館名及び製作年
○著作権処理に関する事項
○テキストデータ凡例
○標題紙
○原本凡例
○目次
○原本まえがき、序、はしがき
○原本本文で最も大きい見出し
○原本あとがき
○著者・編者紹介
○原本奥付
○EPUB奥付
```
やまびこ仕様
: 「テキストデータ凡例」の代わりに「デイジー図書凡例」を入れる。
: 補足資料1で決められているレベル1見出しには、録音図書の全国基準と異なる部分があり、国立国会図書館の仕様書の方に従うことにする。
: 原本にないセクション見出し（「著作権処理に関する事項」「デイジー図書凡例」など）を、`nav.xhtml`や`toc.ncx`だけでなく、全てのセクションレベル1の各セクション冒頭にも付ける。また、それを読み上げる。これによって、 WCAG レベル AAA の条件の1つを満たすことができる。
: 最終的にはlinux上でアクセシブル化の作業をするため、改行コードは`LF`に変換している。

```
「4.1 テキストデータ凡例」
[...]テキストデータ凡例には、次の①～③が含まれていることを原則とする。ただし、当該処理の必要がない場合、及び当該処理を行った箇所で説明を挿入することが適当な場合は、テキストデータ凡例に含める必要はない。
①原本の文字の太字、斜体、傍点（圏点）、下線は、スタイル設定を省略した。
②原本のページ番号を隅付き括弧（【】）で囲い、原本のページが開始する位置に挿入した。例【10ページ】
③各章の図表の詳細な内容説明は、章末に掲載し、本文と相互リンクで結んでいる。
④注は、本文と相互リンクで結んでいる。[...]
⑤一部の数式は、数式を記述するためのマークアップ言語であるMathematical Markup Language (MathML) で入力している。その他、利用に当たって留意すべき編集作業を行う場合もテキストデータ凡例（目次、索引等への編集作業のうち、上記に含まれないものを含む。）に記載すること。

「11.5 太字、斜体、傍点（圏点）、下線」
原本で、強調等の意味を持つ太字、斜体、傍点（圏点）、下線があった場合でも、スタイル等の設定は行わない。「4.1 テキストデータ凡例」のとおり、テキストデータ凡例にスタイルの設定を省略したことを記載する。
```
やまびこ仕様
: ①は不要。太字、斜体、傍点（圏点）、下線はEPUBで表現でき、音訳でもそれなりに表現する。単なるテキストデータと違い、省略する必要がない。再生機でそれを省略する場合があるとしても、それは利用者が自分の使用環境として把握しておくべきことで、提供データの方で省略する必要はない。
: ②は不要。単なるテキストデータと違い、EPUBで利用者に使いやすいページ付けができるので、ページ付けにこの方法を採用しない。
: ③④は、注の対象が注と離れた位置にある場合に必要。
: ⑤は数式を使う場合に必要。

```
「4.2製作者注記」
製作者注記の入力は、「製作者注：」と「注、終わり」の間に入力し、全角亀甲括弧（U+3014「〔 」、U+3015「〕」）で囲うことで、製作者注記と原本の本来の情報と区別できるようにする。原文中に全角亀甲括弧が使用されている場合は別の記号を使用する。製作者注記は、原本の関係する箇所の直後に挿入することを基本とするが、製作者注記の目的・内容に応じて前に挿入してもよい。
```
やまびこ仕様
: `aside` の `footnote` として、基本は〔全角亀甲括弧〕で区別する。本文にこの記号が使われている場合は別の記号を採用する。いずれにしても「デイジー図書凡例」で言う。
: 音訳の慣習では、漢字説明程度の短い注では「音訳者注」を言わない。テキスト上では〔全角亀甲括弧〕によって区別できているし、音声についても音訳技術で区別できていれば良いと考える。
: 文字があるので漢字説明が不要という解釈も有り得るが、聞き流すだけの利用者を考慮すると、文意の誤解を防ぐための漢字説明は必要。不要な利用者は読み飛ばし機能を使えば良い。

```
「10.1 属性値pagebreakを持つepub:type属性による原本ページ番号の挿入」
title属性はページ数の数字部分を算用数字で入力する（漢数字、ローマ数字等の場合は算用数字に置き換える）。id属性の値は任意とするが、ページ番号と関連があるものが望ましい。
「10.2 記入例」
【EPUBサンプル】
高齢者サービスを提供する図書館につい<span id="page12" class="pagenum" title="12" epub:type="pagebreak" role="doc-pagebreak">【12ページ】</span>てケーススタディを行いました。
```
やまびこ仕様
: ページ番号をフレーズの途中に入れても良い！ただし、 Media Overlays がうまく働くかどうか、いろいろな条件で実験を重ねる必要がある。
: この基準はテキストデータの基準から来たもので、EPUB形式には Daisy Consortium が推奨する便利な方法が別にある。文の途中にページ番号が見えていると、読む際には煩わしいので、 Daisy Consortium の方法を採用する。具体的には以下のようにする。
: 原本のページ開始位置に該当する箇所に以下の形を挿入する。これは24ページの例。
```html
   <span
       epub:type="pagebreak"
       role="doc-pagebreak"
       id="pg24"
       aria-label="24"/>
```
 ChattyInfty3 編集上は、これ自体がフレーズを区切る性質があるので、フレーズ区切り`Ctrl + Shift + /`の代わりになる。  
1フレーズの内部に改ページを入れる場合は、この改ページを無声化`Ctrl + 0`すればフレーズ切断を防げる。  
 ChattyInfty3 付属のページ機能は段落を区切ってしまうので利用しない。

```
「6.2 スタイルの設定」
長さ、大きさ等の数値の指定は、本仕様で指定する場合を除き、固定値（ポイント、ピクセルなど）ではなく、相対値（em又はパーセント）で指定する。

「6.3 ハイパーリンク」
「6.3.1 内部リンク（アンカーリンク）」
以下は、内部リンクをはる。①目次から本文へのリンク（詳細は「8ナビゲーション文書及びNCX文書」を参照のこと）②本文と注の相互リンク（詳細は「12注」を参照のこと）③本文と、章末等に配置した長文の代替テキストの相互リンク（詳細は「16.3 長文の代替テキスト」を参照のこと）以下はリンクをはらない。①巻末の索引から本文へのリンク
「6.3.2 外部リンク」
本文中に外部のWebサイト等のURLが掲載されている場合は、リンク切れになっている場合も含めてリンクをはる。メールアドレスにはリンクをはらない。
```
やまびこ仕様
: URLは、全てリンク化する。

```
「6.5 フォントの埋め込み」
フォントの埋め込みは行わない。
```
やまびこ仕様
: Dyslexia 向けのフォントであっても、埋め込んではいけない。

```
「7 パッケージ文書（OPFファイル）」
「7.1 メタデータの入力」
パッケージ文書（OPFファイル）に「補足資料3 パッケージ文書（OPFファイル）に入力するメタデータ」のとおり、メタデータを入力する。
```
やまびこ仕様
: `opf` に WCAG の `schema` を入れる。 Ace by Daisy で確認する必要がある。必要な Dublin Core についても「補足資料3」に従う。

```
「9.3 EPUBにおけるテキストの構造化」
原本のアウトラインに基づいて、見出しタグ（h1～h6要素）、section要素、p要素等を用いて、適切に構造化する。
```
やまびこ仕様
: DAISY2.02 の製作慣習と違って、深い階層のセクションを浅く直す必要がないので、できるだけ原本の構造を反映したセクション構造にする。
: DAISY2.02 録音図書 では「グループ」という特殊な機能があり、これが再生機ではセクション切り替えと同じボタンで利用するように作られているため、セクション階層が深いとグループの利用が面倒だった。
: DAISY 2.02 の2003年追加事項、DAISY 3 、EPUB 3 仕様で作るものでは、グループを使わないのでこの懸念がない。利用者は、深い階層を使いたくなければ使わなければ良いだけである。

```
「9.4 コンテンツ文書におけるセマンティクス（epub:type属性）」
本件作業では、EPUB 3 Structural Semantics Vocabulary5で定義されている語彙のうち、最低限以下の語彙をコンテンツ文書で使用する。
＜出版内容の区分＞
frontmatter、bodymatter、backmatter
＜注＞
footnote、end note、footnotes、endnotes、noteref
＜ページネーション＞
pagebreak
```
やまびこ仕様
: ChattyInfty3 やPlextalk Producer ではこれらを正しく指定できないので、納品前のアクセシブル化の際に修正する必要がある。

```
「11. 7 段落」
段落はp要素で構造化する（段落の前後は空行が挿入されているため、空行を段落代わりと見做してよい）。原本において段落の先頭行が字下げされている場合は、2文字以上字下げされている場合も含め、1文字分の字下げをスタイルシートで指定する。
なお、段落と段落の間隔は、スタイルシートで指定しない。
```
やまびこ仕様
: 段落には`<p></p>`を使う。原本の字下げとして原稿に全角空白がついていれば削除し、代わりにスタイルシートで指定：
```css
p {text-indent: 1em;}
```
: `<p></p>`の中に`<aside></aside>`が入っていると epubcheck を通らない。解決方法は2種類考えられる。
1. 納品前の工程で、`xhtml`内の`<aside></aside>`を`<p></p>`の直後に移動し、`smil`内の順番を変えないようにすれば、読み上げ順序を変えずに`aside`を`p`の外に置けるはず。
1. `<p></p>`を`<section></section>`に置き換える方法は、許されるかどうかわからないが、可能。

```
「11.10 ルビ表記の設定について」
リーディングシステムがルビテキストを囲う括弧によく採用する丸括弧は、原本の本文中においても使用されている可能性が高く、利用者がルビテキストを含む箇所をコピーアンドペーストした場合に、原本の本文中に由来する丸括弧かルビテキストを囲う括弧が区別できない恐れがある。それを避けるため、rp要素で、二重山括弧（U+300A「《 」、U+300B「》」）をルビテキストを囲う括弧に指定する。
【サンプル】<ruby>国立国会図書館<rp>《</rp><rt>こくりつこっかいとしょかん</rt> <rp>》</rp></ruby>に行く
```
やまびこ仕様
: ChattyInfty3から出力すると`《》`で入力しても`<rp>(</rp> <rp>)</rp>`に変わってしまうので、納品前に`<rp>《</rp> <rp>》</rp>`に書き換える。

```
「16.2    alt属性に入力する代替テキスト」
代替テキストが1パラグラフで収まる長さの場合は、画像データのalt属性に入力する。
＜原本＞『授業を変える : 認知心理学のさらなる挑戦』（米国学術研究推進会議編著、北大路書房、2002）p52「図3.1  記憶した平均桁数の変化」
＜上記原本のalt属性への代替テキストの入力例＞
<img src="img008.jpg" alt="折れ線グラフ。横軸は練習日数で、0から40までの5刻み。縦軸は平均桁数で0から80までの10刻み。1日目＝10桁にはじまり、約36日目＝約77桁に至るまで、前日からの伸び（緩急）は日によってさまざまで、途中、約5回前日よりも桁数が下がっている（ただし3日連続で下がることはない）こともあるが、全体としては右肩上がりとなっている。"/> 
```
やまびこ仕様
: 短めの画像説明は、`alt`に書いてそれを読み上げるだけで良い。この場合、スキップ機能は働かない。

```
「16.3   長文の代替テキスト」
代替テキストが長文になる場合（目安として、目安として、2つ以上のパラグラフから構成される場合、リストを用いる場合、構造化された表を用いる必要がある等の場合）、alt属性への入力に加え、長文の代替テキストを章末等に「図等の内容説明」として原本における掲載順に配置し、画像を挿入した本文と長文の代替テキストを「15 非テキストコンテンツの画像データの挿入」及び本項のとおり相互リンクで結ぶ。
```
やまびこ仕様
: 長い画像説明は `endnote` とし、まとめて `endnotes` セクションを作り、 `toc` にも入れる。
: 絵本の場合は `endnote` にするとかえって使いにくいので、 `footnote` で十分ではないか？ `footnote` ならば `toc` に入れる必要もない。

#### 2. テキストデータに関する仕様

[学術文献を原本とする視覚障害者等用のテキストデータ製作における代替テキスト製作に関する仕様書（ver.2020.1）（PDF: 3.3MB）](https://www.ndl.go.jp/jp/library/supportvisual/docs/ac_image_description_spec.pdf)を参考にする。

```
「1. 共通方針 (2) 説明文の組み立て」
(共通6)グラフは文章による説明が望ましい場合を除き、表を作成する。
「2-4. グラフ」
(グラフ方針3)文章による説明が望ましい場合（全体的な傾向のみを示すのが目的のグラフで各数値が記載されていない、特定の1点に注目しておりそれ以外の個々の数値を把握することが期待されていない等、グラフでありながら図に近い性質のもの）を除き、各数値を入力した表を作成する。なお、必要に応じて複数の表に分け、セル結合は行わない。
```
やまびこ仕様
: グラフ説明を作って読み上げる代わりに、EPUBの表の形式で書き直し、各マス目をそのまま読み上げる。それでわかりにくい場合のみ、グラフ説明を作る。

```
「1. 共通方針 (2) 説明文の組み立て」
(共通15)ラテン文字・数字は半角文字で入力する（「NHK職 員 」、「1章」等）。カタカナは全角文字で入力する。装飾（太字、斜体、傍点（圏点）、下線、ルビ）は使用しない。必要な場合を除き、空行の挿入や字下げをしない。
```
やまびこ仕様
: 説明文の文字列は読み上げと同じ文章。英数字を半角で書く。

```
「1. 共通方針 (2) 説明文の組み立て」
(共通16)Unicodeにある文字は原本のとおり入力する。[...]Unicodeにない文字は、不完全な形の文字・ヨミ・ゲタ文字（〓）のいずれかを入力し、その後ろに〔製作者注：○○○。注、終わり〕を入力する。
```
やまびこ仕様
: 外字を作らない・使わない。
: 読み上げでどう処理するか？漢字説明の必要な場合以外は、上の規則に従って書き込むだけで、何事もなかったように読み上げて良い。


